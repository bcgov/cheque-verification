# replicaCount is ignored when autoscaling is enabled
replicaCount: 2

image:
  repository: ghcr.io/bcgov/cheque-verification-frontend
  tag: latest
  pullPolicy: Always

service:
  enabled: true
  type: ClusterIP
  ports:
    - name: http
      port: 80
      targetPort: 3000
      protocol: TCP

# Route configuration
route:
  host: "" # Leave empty for auto-generated hostname, or specify custom hostname
  annotations:
    # Load balancing strategy (distributes traffic evenly)
    haproxy.router.openshift.io/balance: "roundrobin"
    # Enable HAProxy rate limiting
    haproxy.router.openshift.io/rate-limit-connections: "true"
    # Max concurrent TCP connections per IP
    haproxy.router.openshift.io/rate-limit-connections.concurrent-tcp: "10"
    # Max HTTP requests per second per IP
    haproxy.router.openshift.io/rate-limit-connections.rate-http: "20"
    # Max TCP connections per second per IP
    haproxy.router.openshift.io/rate-limit-connections.rate-tcp: "50"
    # Disable sticky sessions for better rate limiting
    haproxy.router.openshift.io/disable_cookies: "true"

# Resource limits - based on actual usage (~40 MiB per pod)
# Combined budget: 500 MiB / 100m CPU for frontend + backend
resources:
  requests:
    memory: "40Mi"
    cpu: "5m"
  limits:
    memory: "80Mi"
    cpu: "15m"

# Horizontal Pod Autoscaler configuration
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 3
  # Scale up when CPU usage exceeds 70%
  targetCPUUtilizationPercentage: 70
  # Scale up when memory usage exceeds 80%
  targetMemoryUtilizationPercentage: 80

# Pod Disruption Budget - ensures availability during cluster maintenance
podDisruptionBudget:
  enabled: true
  # Always keep at least 1 pod running during voluntary disruptions
  minAvailable: 1

nodeSelector: {}

tolerations: []

affinity: {}

# Config for the frontend (API endpoints, etc.)
config:
  BACKEND_URL: "http://cheque-verification-backend:80"
  LOG_LEVEL: "INFO"
